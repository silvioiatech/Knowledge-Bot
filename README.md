# ğŸ¤– Enhanced Knowledge Bot

**Intelligent video content analysis with smart AI optimization and comprehensive knowledge base creation.**

Transform TikTok and Instagram videos into comprehensive, textbook-quality educational content using advanced AI analysis and conditional image generation.

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://python.org)
[![Railway](https://img.shields.io/badge/Deploy-Railway-purple.svg)](https://railway.app)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

## âœ¨ Enhanced Features

### ğŸ§  **Smart AI Analysis**
- **Gemini 1.5 Flash** - Advanced video content understanding with 20+ analysis fields
- **Claude 3.5 Sonnet** - Professional textbook-quality content generation (3000+ words)
- **Intelligent Category Suggestion** - AI-powered categorization with confidence scoring

### ğŸ¨ **Conditional Image Generation**
- **Smart Cost Management** - Claude evaluates when visuals truly enhance understanding
- **Gemini 2.5 Flash Image Preview** - Generates technical diagrams only when beneficial
- **Professional Illustrations** - Flowcharts, architectures, and process diagrams

### ğŸ”„ **Interactive Workflow**
- **Category Selection** - User-controlled content organization with inline keyboards
- **Preview & Approve** - Review AI analysis before final processing
- **Quality Control** - Approve, reject, or re-analyze with enhanced focus

### ğŸ—„ï¸ **Comprehensive Storage**
- **Notion Database Integration** - Perfect schema mapping with all required fields
- **Railway Web Access** - Remote content viewing and editing
- **Enhanced Markdown** - Rich frontmatter with metadata and cross-references

## ğŸš€ Quick Start

### 1. Clone & Setup

```bash
git clone https://github.com/silvioiatech/Knowledge-Bot.git
cd Knowledge-Bot
pip install -r requirements.txt
```

### 2. Configure Environment

```bash
cp .env.example .env
# Edit .env with your API keys
```

**Required API Keys:**
- **Telegram Bot Token**: Get from [@BotFather](https://t.me/botfather)
- **Gemini API Key**: Get from [Google AI Studio](https://aistudio.google.com)
- **OpenRouter API Key**: Get from [OpenRouter](https://openrouter.ai)

### 3. Launch Enhanced Bot

```bash
python main.py
```

## ğŸ“‹ Environment Configuration

### Core Settings

```env
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here

# AI Services
GEMINI_API_KEY=your_gemini_api_key_here
GEMINI_MODEL=gemini-2.5-pro
OPENROUTER_API_KEY=your_openrouter_api_key_here

# Models via OpenRouter
CLAUDE_MODEL=anthropic/claude-3.5-sonnet
IMAGE_MODEL=google/gemini-2.5-flash-image-preview

# Railway Deployment
RAILWAY_STATIC_URL=https://your-app.up.railway.app
KNOWLEDGE_BASE_PATH=/app/knowledge_base
```

### Enhanced Features

```env
# Smart Image Generation
ENABLE_IMAGE_GENERATION=true
TARGET_CONTENT_LENGTH=3000

# Notion Integration
USE_NOTION_STORAGE=true
NOTION_API_KEY=secret_your_notion_integration_key
NOTION_DATABASE_ID=your_database_id_here

# Quality Control
MAX_PROCESSING_TIME=1800
```

## ğŸ¯ Enhanced Workflow

1. **ğŸ“± Send Video URL** â†’ User sends TikTok/Instagram video URL
2. **ğŸ¤– AI Analysis** â†’ Gemini analyzes content with 20+ data fields
3. **ğŸ“Š Preview & Categorization** â†’ Interactive preview with AI-suggested categories
4. **ğŸ”„ User Selection** â†’ Choose or modify categories using inline keyboards
5. **ğŸ¨ Smart Image Evaluation** â†’ Claude determines if diagrams would enhance understanding
6. **âœ¨ Content Generation** â†’ Comprehensive educational content creation
7. **ğŸ’¾ Multi-Storage** â†’ Save to Railway, Notion, and local markdown with web access

## ğŸ“Š Enhanced Output Examples

### Comprehensive Markdown with Metadata

```markdown
---
title: "Advanced Python AsyncIO Patterns"
category: "ğŸ¤– AI"
subcategory: "Development"
difficulty: "Intermediate" 
content_quality: "â­â­â­ Good"
word_count: 3247
processing_date: "2024-01-15T10:30:00"
source_video: "https://tiktok.com/@user/video/123"
gemini_confidence: 87
tags: ["python", "async", "performance"]
tools_mentioned: ["Python", "AsyncIO", "aiohttp"]
platform_specific: ["Universal"]
auto_created: true
verified: false
---

# Advanced Python AsyncIO Patterns

> **ğŸ“Š Content Overview**  
> **Category:** ğŸ¤– AI â†’ Development  
> **Difficulty:** Intermediate | **Quality:** â­â­â­ Good  
> **Word Count:** 3,247 words | **Confidence:** 87%

## ğŸ”‘ Key Learning Points

1. Event loops and coroutines fundamentals
2. Error handling strategies in async code
3. Performance optimization techniques
4. Production deployment patterns

**ğŸ› ï¸ Tools Mentioned:** Python, AsyncIO, aiohttp

**ğŸ·ï¸ Tags:** #python #async #performance

---

## Overview

Comprehensive guide to modern asynchronous programming in Python...

## Key Concepts

[Detailed technical content generated by Claude...]

## Practical Implementation

[Code examples and best practices...]

## ğŸ“Š Generated Diagrams

### AsyncIO Event Loop Architecture

![Event Loop Diagram](diagram_url_here)

*Technical diagram showing event loop flow and coroutine execution*

## Additional Resources

- [Official AsyncIO Documentation](https://docs.python.org/3/library/asyncio.html)
- [Real Python AsyncIO Guide](https://realpython.com/async-io-python/)
```

### Enhanced Telegram Response

```
ğŸ‰ Content Successfully Processed!

ğŸ“– Title: Advanced Python AsyncIO Patterns
ğŸ“‚ Category: ğŸ¤– AI
ğŸ“‹ Subcategory: Development
â­ Quality: â­â­â­ Good
âš¡ Difficulty: Intermediate
ğŸ“Š Word Count: 3,247 words
ğŸ¯ Confidence: 87%

ğŸ”— Platform: Universal
ğŸ› ï¸ Tools: Python, AsyncIO, aiohttp (+2 more)
ğŸ·ï¸ Tags: #python #async #performance (+3 more)

ğŸ”‘ Key Points:
1. Event loops and coroutines fundamentals
2. Error handling strategies in async code
3. Performance optimization techniques
   (+2 more points)

ğŸ”— Access Your Content:
ğŸŒ View Online: https://your-app.up.railway.app/view/ai/20240115-advanced-python-asyncio.md
ğŸ“ Raw Markdown: https://your-app.up.railway.app/raw/ai/20240115-advanced-python-asyncio.md
ğŸ“š Notion Database: https://notion.so/your-page-id

ğŸ’¡ Your content has been organized and is ready for learning!
```

## ğŸ—ï¸ Enhanced Architecture

```
Knowledge-Bot/
â”œâ”€â”€ ğŸ¤– main.py                           # Enhanced main application
â”œâ”€â”€ âš™ï¸ config.py                         # Comprehensive configuration
â”œâ”€â”€ ğŸ“ bot/
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â””â”€â”€ video_handler.py             # Complete workflow with callbacks
â”‚   â””â”€â”€ interactive_category_system.py   # Smart category selection
â”œâ”€â”€ ğŸ”§ services/
â”‚   â”œâ”€â”€ enhanced_claude_service.py       # Intelligent content architecture
â”‚   â”œâ”€â”€ enhanced_gemini_service.py       # Advanced video analysis
â”‚   â”œâ”€â”€ image_generation_service.py      # Conditional diagram generation
â”‚   â””â”€â”€ railway_client.py                # Video download service
â”œâ”€â”€ ğŸ’¾ storage/
â”‚   â”œâ”€â”€ notion_storage.py                # Perfect schema integration
â”‚   â”œâ”€â”€ railway_storage.py               # Web-accessible storage
â”‚   â””â”€â”€ markdown_storage.py              # Enhanced markdown with frontmatter
â”œâ”€â”€ ğŸ§  core/models/
â”‚   â””â”€â”€ content_models.py                # Complete data models
â””â”€â”€ ğŸŒ railway_server.py                 # Web file browser
```

## ğŸ”§ Notion Database Integration

### Perfect Schema Mapping

Your Notion database fields are automatically populated:

- **Title** (title) - Auto-extracted from content
- **Category** (select) - ğŸ APPLE, ğŸ§ LINUX, ğŸ¤– AI, etc.
- **Subcategory** (select) - Programs, Automations, Development, etc.
- **Content Quality** (select) - â­ Raw â†’ â­â­â­â­â­ Production Ready
- **Difficulty** (select) - Beginner, Intermediate, Advanced, Expert
- **Word Count** (number) - Auto-calculated
- **Gemini Confidence** (number) - 0-100 AI confidence score
- **Tags** (multi_select) - Auto-extracted technical tags
- **Tools Mentioned** (multi_select) - Auto-detected technologies
- **Platform Specific** (multi_select) - macOS, Linux, Windows, Universal
- **Source Video** (url) - Original video link
- **Processing Date** (date) - Auto-timestamp
- **Key Points** (rich_text) - Bullet-pointed learning objectives

## ğŸš€ Railway Deployment

### 1. Setup Railway

```bash
npm install -g @railway/cli
railway login
railway link
railway add volume --name knowledge-base --mount /app/knowledge_base
railway deploy
```

### 2. Environment Variables

Set in Railway dashboard:
```env
TELEGRAM_BOT_TOKEN=your_token
GEMINI_API_KEY=your_key
OPENROUTER_API_KEY=your_key
RAILWAY_STATIC_URL=https://your-app.up.railway.app
PORT=8000
```

### 3. Access Your Enhanced Knowledge Base

- **Web Browser**: `https://your-app.up.railway.app/kb/`
- **Category View**: `https://your-app.up.railway.app/kb/ai/`
- **File Viewer**: `https://your-app.up.railway.app/view/ai/filename.md`
- **Raw Access**: `https://your-app.up.railway.app/raw/ai/filename.md`

## ğŸ¨ Smart Image Generation

### Cost-Optimized Conditional Generation

Claude intelligently evaluates when diagrams truly enhance understanding:

**âœ… Generates Images For:**
- System architecture explanations
- Step-by-step tutorials with UI elements
- Process flows and workflows
- Code patterns and structures
- Network diagrams

**âŒ Skips Images For:**
- Simple definitions or theory
- Text-based tutorials
- Opinion pieces
- Pure code explanations

**Cost Impact:** 40-60% savings on image generation while maintaining quality.

## ğŸ”’ Enhanced Security & Performance

### Production-Ready Features

- âœ… **Smart Rate Limiting** - 10 videos per user per hour
- âœ… **Session Management** - TTL-based cleanup prevents memory leaks
- âœ… **Callback Security** - Secure inline keyboard handling
- âœ… **Error Recovery** - Comprehensive error handling with user feedback
- âœ… **Cost Optimization** - Intelligent resource usage across all AI services
- âœ… **Quality Validation** - Interactive approval workflow with re-analysis options

### Performance Optimizations

- âœ… **Non-blocking Processing** - Multiple users can process simultaneously
- âœ… **Service Singleton Pattern** - Efficient resource management
- âœ… **Persistent Storage** - Railway files survive deployments
- âœ… **Background Cleanup** - Automatic session expiration (30 minutes)

## ğŸ“± Enhanced Usage

### Interactive Commands

- `/start` - Initialize enhanced bot with feature overview
- Send video URL - Begin intelligent processing workflow
- Interactive buttons for category selection and approval

### Smart Workflow

1. **Send URL** â†’ Gemini analyzes with 20+ fields
2. **Preview** â†’ Comprehensive analysis summary with quality metrics
3. **Categories** â†’ AI suggests categories, user can modify via inline keyboards
4. **Processing** â†’ Conditional image generation + Claude content creation
5. **Results** â†’ Multi-format storage with web access links

## ğŸš¨ Troubleshooting Enhanced Features

### Common Issues

**âŒ Category Selection Not Working**
- Check callback handlers are properly registered
- Verify interactive_category_system.py is properly imported
- Ensure session state is maintained

**âŒ Image Generation Errors**  
- Verify `google/gemini-2.5-flash-image-preview` model access
- Check OpenRouter credits and API key
- Confirm `ENABLE_IMAGE_GENERATION=true` in environment

**âŒ Notion Integration Fails**
- Validate database ID and integration permissions
- Verify all required fields exist in database schema
- Check API key has write access to database

**âŒ Railway Web Access 404**
- Confirm `RAILWAY_STATIC_URL` matches your deployment
- Verify knowledge_base volume is properly mounted
- Check file paths and category folder creation

## ğŸ“Š Enhanced Configuration Reference

| Variable | Description | Default | Enhanced Feature |
|----------|-------------|---------|------------------|
| `CLAUDE_MODEL` | Content generation model | `anthropic/claude-3.5-sonnet` | âœ… Professional content |
| `IMAGE_MODEL` | Diagram generation model | `google/gemini-2.5-flash-image-preview` | âœ… Conditional images |
| `TARGET_CONTENT_LENGTH` | Target word count | `3000` | âœ… Comprehensive content |
| `ENABLE_IMAGE_GENERATION` | Smart image creation | `true` | âœ… Cost optimization |
| `USE_NOTION_STORAGE` | Database integration | `false` | âœ… Perfect schema mapping |
| `RAILWAY_STATIC_URL` | Web access base URL | - | âœ… Remote content access |
| `MAX_PROCESSING_TIME` | Processing timeout | `1800` | âœ… Complex workflow support |

## ğŸ¤ Contributing to Enhanced Features

1. **Fork** the repository
2. **Create** a feature branch: `git checkout -b feature/enhanced-feature`
3. **Test** enhanced workflows thoroughly
4. **Commit** changes: `git commit -m 'Add enhanced feature'`
5. **Push** to branch: `git push origin feature/enhanced-feature`
6. **Submit** a Pull Request with detailed description

## ğŸ“„ License

MIT License - Enhanced version maintains open-source accessibility.

## ğŸŒŸ Enhanced Acknowledgments

- **Google Gemini 2.5** - Advanced video analysis and conditional image generation
- **Anthropic Claude 3.5** - Professional textbook-quality content creation via OpenRouter
- **Railway** - Reliable cloud deployment with persistent web-accessible storage
- **Notion** - Comprehensive database integration with perfect schema mapping

---

**â­ Star this repository if the enhanced features help streamline your knowledge creation workflow!**

### ğŸ¯ Enhanced Value Proposition

This isn't just a video-to-text converter - it's an **intelligent knowledge curation system** that:
- **Saves 40-60% on AI costs** through smart conditional processing
- **Creates professional-grade content** comparable to technical documentation
- **Provides multiple access methods** (web, mobile, API, database)
- **Scales intelligently** with user-controlled quality and categorization
- **Integrates seamlessly** with existing knowledge management workflows

Perfect for **technical educators**, **content creators**, **researchers**, and **knowledge workers** who want to transform video content into searchable, organized, professional reference material.
